{% extends "base.html" %}
{% block content %}

<h2 class="room-title">Room {{ room }}</h2>

<div id="chat-box" class="chat-box">
    {% for msg in messages %}
        <div class="msg">
            <span class="avatar">{{ msg.avatar }}</span>
            <b>{{ msg.user }}:</b> {{ msg.text }}
        </div>
    {% endfor %}
</div>

<input id="message-input" placeholder="Type...">
<button onclick="sendMessage()">Send</button>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
const socket = io();
const name = "{{ user }}";
const room = "{{ room }}";

socket.emit("join", { name, room });

socket.on("message", (data) => {
    addMessage(data.avatar, data.user, data.text);
});

function addMessage(avatar, user, text) {
    const box = document.getElementById("chat-box");
    box.innerHTML += `
        <div class="msg">
            <span class="avatar">${avatar}</span>
            <b>${user}:</b> ${text}
        </div>
    `;
    box.scrollTop = box.scrollHeight;
}

function sendMessage() {
    const input = document.getElementById("message-input");
    const text = input.value.trim();
    if (!text) return;

    socket.emit("message", { avatar: "â­", user: name, text, room });
    input.value = "";
}

document.getElementById("message-input").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
        e.preventDefault();
        sendMessage();
    }
});
</script>

{% endblock %}