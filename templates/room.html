{% extends 'base.html' %}
{% block content %}

<div class="chat-box">

    <h2 class="room-title">Room: {{code}}</h2>

    <div id="messages" class="messages"></div>

    <div class="input-row">
        <input id="message" placeholder="Type your message..." class="input-pixel">
        <button onclick="sendMessage()" class="btn-pink">Send</button>
    </div>

</div>

<script>
    var socketio = io();

    const avatars = ["âœ¨","ğŸŒ™","ğŸŒ¸","â­","â˜ï¸"];
    const myAvatar = avatars[Math.floor(Math.random() * avatars.length)];

    function addMessage(avatar, name, msg, time) {
        const area = document.getElementById("messages");

        const bubble = document.createElement("div");
        bubble.classList.add("bubble");
        bubble.innerHTML = `
            <div class="bubble-avatar">${avatar}</div>
            <div>
                <strong>${name}</strong>: ${msg}
                <div class="bubble-time">${time}</div>
            </div>
        `;

        area.appendChild(bubble);
        area.scrollTop = area.scrollHeight;
    }

    socketio.on("message", data => {
        addMessage(data.avatar, data.name, data.message, data.time);
    });

    function sendMessage() {
        const input = document.getElementById("message");
        if (!input.value.trim()) return;

        socketio.emit("message", {message: input.value, avatar: myAvatar});
        input.value = "";
    }

    document.getElementById("message").addEventListener("keyup", e => {
        if (e.key === "Enter") sendMessage();
    });
</script>

{% endblock %}