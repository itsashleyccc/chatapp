{% extends 'base.html' %}
{% block content %}

<div class="chat-wrapper">

    <h2 class="room-header">æˆ¿é–“ï¼š{{code}} ğŸ¡</h2>

    <div id="messages" class="message-area"></div>

    <div class="input-row">
        <input id="message" placeholder="è¼¸å…¥è¨Šæ¯â€¦" />
        <button onclick="sendMessage()" id="send-btn" class="btn-pixel-pink">é€å‡º</button>
    </div>

</div>

<script>
    var socketio = io();

    const avatars = ["ğŸ’–","â­","ğŸ¬","ğŸª","ğŸ“","ğŸ°"];
    const myAvatar = avatars[Math.floor(Math.random() * avatars.length)];

    function addMessage(avatar, name, msg, time) {
        const box = document.createElement("div");
        box.classList.add("msg-box");
        box.innerHTML = `
            <div class="avatar">${avatar}</div>
            <div class="msg">
                <strong>${name}</strong>: ${msg}
                <div class="time">${time}</div>
            </div>
        `;
        document.getElementById("messages").appendChild(box);
    }

    socketio.on("message", (data) => {
        addMessage(data.avatar, data.name, data.message, data.time);
    });

    function sendMessage() {
        const input = document.getElementById("message");
        if (!input.value.trim()) return;

        socketio.emit("message", {
            message: input.value,
            avatar: myAvatar
        });

        input.value = "";
    }

    document.getElementById("message").addEventListener("keyup", function(e){
        if (e.key === "Enter") sendMessage();
    });

    {% for msg in messages %}
        addMessage("{{msg.avatar}}", "{{msg.name}}", "{{msg.message}}", "{{msg.time}}");
    {% endfor %}
</script>

{% endblock %}